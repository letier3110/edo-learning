<head>
  <meta charset="UTF-8" />
  <script src="https://unpkg.com/wanakana"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet" />
  <style>
    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 16px;

      height: 100vh;
      position: relative;
    }
    .originalText {
      font-family: 'Kosugi Maru', sans-serif;
      font-size: 3rem;
      line-height: 3.75rem;
      font-weight: bold;
    }
    span {
      padding: 6px 2px;
      border-radius: 10px;
      color: white;
    }
    .romaji {
      user-select: none;
      font-size: 1rem;
      letter-spacing: 0.7rem;
    }
    .kana {
      user-select: none;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="center">
    <div class="romaji"></div>
    <div class="originalText">私はサッカーをするために公園に行きます</div>
    <div class="kana"></div>
  </div>
  <input class="original"></input>
  <script>
    const bgColors = ['#ff55aa', '#55aaff', '#55ffaa', '#ffaa55']
    const fontColors = ['white', 'white', 'black', 'white']
    const initialSpecialChars = ['は', '行', 'に', 'を']
    const originalTextElement = document.getElementsByClassName('originalText')[0]
    /**
     * @param {string[]} specialChars - array of special characters to highlight
     * @param {boolean} romajiHighlight - if true, highlight romaji
     * @param {boolean} kanaHighlight - if true, highlight kana
     */
    const highlight = (specialChars, romajiHighlight, kanaHighlight) => {
      const area = originalTextElement
      const areaText = area.textContent
      for (let i = 0; i < specialChars.length; i++) {
        const re = new RegExp(specialChars[i], 'g')
        const ci = i % bgColors.length
        area.innerHTML = area.innerHTML.replace(re, `<span style="background-color: ${bgColors[ci]}; color: ${fontColors[ci]}">${specialChars[i]}</span>`)
      }

      const romaji = wanakana.toRomaji(areaText, { upcaseKatakana: true })
      const kana = wanakana.toHiragana(areaText)

      if (romajiHighlight) {
        document.getElementsByClassName('romaji')[0].innerHTML = romaji
      }
      if (kanaHighlight) {
        document.getElementsByClassName('kana')[0].innerHTML = kana
      }
    }

    const originalText = originalTextElement.innerHTML
    
    document.addEventListener('selectionchange', () => {
      const selection = window.getSelection().toString()
      if (selection.length === 0) {
        originalTextElement.innerHTML = originalText
        return
      }
      highlight(selection, true, true)
    })

    document.getElementsByClassName('original')[0].value = originalText
    highlight(initialSpecialChars);
  </script>
</body>
